<table class="container">
  <tr class="header-row">
    @for (field of fields(); track field.name) {
      @if (field.icon) {
        <th><app-icon [type]="field.icon" /></th>
      } @else {
        <th>{{ field.label }}</th>
      }
    }
  </tr>
  @for (row of data(); track row) {
    <tr class="row" (click)="rowClick($index, row)" [class.selectable-row]="!editing">
      @for (field of fields(); track field.name) {
        <td>
          @switch (field.type) {
            @case ('string') {
              @if (editing) {
                <input type="text" [(ngModel)]="row[field.name]" />
              } @else {
                <div>{{ row[field.name] }}</div>
              }
            }
            @case ('text') {
              @if (editing) {
                <textarea [(ngModel)]="row[field.name]" rows="3" cols="20"> </textarea>
              } @else {
                <pre>{{ row[field.name] }}</pre>
              }
            }
            @case ('number') {
              @if (editing) {
                <input type="text" [(ngModel)]="row[field.name]" class="number-input" size="2" />
              } @else {
                <div>{{ row[field.name] }}</div>
              }
            }
            @case ('enum') {
              @if (editing) {
                <mat-select [(ngModel)]="row[field.name]">
                  @for (value of field.values; track $index) {
                    <mat-option [value]="value">{{ value }}</mat-option>
                  }
                </mat-select>
              } @else {
                <div>{{ row[field.name] }}</div>
              }
            }
            @case ('image') {
              @if (editing) {
                <app-resource-reference [path]="row[field.name]" />
              } @else {
                <div>
                  <app-resource-reference [path]="row[field.name]" />
                </div>
              }
            }
            @case ('boolean') {
              <div>
                <mat-checkbox
                  [(ngModel)]="row[field.name]"
                  [disabled]="!editable || editingRow != row || !field.editable"
                ></mat-checkbox>
              </div>
            }
            @case ('actions') {}
          }
        </td>
      }
    </tr>
  }
</table>
@if (editable) {
  @if (editing) {
    <button matButton (click)="endEditing()" matTooltip="Edit entries">
      <mat-icon class="toolbar-icon">check</mat-icon>
    </button>
  } @else {
    <button matButton (click)="startEditing()" matTooltip="Delete">
      <mat-icon class="toolbar-icon">edit</mat-icon>
    </button>
  }
}

<button matButton (click)="newRow()" matTooltip="Add">
  <mat-icon class="toolbar-icon">add</mat-icon>
</button>
